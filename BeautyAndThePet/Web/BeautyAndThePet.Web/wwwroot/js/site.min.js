$(document).ready(
	getAllUsers(), filterFunction()
);

function getAllUsers() {
	$("#myInput").on('click', function (e) {
		e.preventDefault();
		var that = $(this);
		that.off('click');

		var ul = document.createElement('ul');
		ul.setAttribute("id", "myUL");

		$.ajax({
			type: 'GET',
			url: "/WebService/GetUsers",
			dataType: 'json',
			success: function (data) {
				console.log(data);
				data.forEach(e => {
					var li = document.createElement('li');
					var a = document.createElement('a');
					a.setAttribute('href', `/Users/ViewInfo/${e.Username}`);
					a.innerHTML = e.Username;
					li.innerHTML = a.outerHTML;
					ul.appendChild(li);
					var myDropdown = document.querySelector('#myDropdown');
					myDropdown.appendChild(ul);
					a.style.display = "none";
				});
			},
			error: function (emp) {
				alert('error');
			}
		}).always(function () {
			that.on('click', login); // add handler back after ajax
		});
	});
}

function filterFunction() {
	var input, filter, ul, li, a, i, txtValue;

	input = document.getElementById("myInput");
	filter = input.value.toUpperCase();

	ul = document.getElementById("myUL");
	li = ul.getElementsByTagName("li");

	if (filter.length == 0) {
		document.getElementById("myDropdown").classList.remove("show");
	}
	else {

		document.addEventListener("click", function (evt) {
			var flyoutElement = document.getElementById('myDropdown'),
				targetElement = evt.target;  // clicked element

			do {
				if (targetElement == flyoutElement) {
					// This is a click inside. Do nothing, just return.
					document.getElementById("myDropdown").classList.toggle("show");
					return;
				}
				// Go up the DOM
				targetElement = targetElement.parentNode;
			} while (targetElement);

			// This is a click outside.
			document.getElementById("myDropdown").classList.remove("show");
		});

		document.getElementById("myDropdown").classList.toggle("show");
		div = document.getElementById("myDropdown");
		a = div.getElementsByTagName("a");

		for (i = 0; i < li.length; i++) {
			a = li[i].getElementsByTagName("a")[0];
			txtValue = a.textContent || a.innerText;
			if (txtValue.toUpperCase().indexOf(filter) > -1) {
				li[i].style.display = "";
			} else {
				li[i].style.display = "none";
			}
		}
	}
}